<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil â€” SETRUM</title>

  <link rel="stylesheet" href="../CSS/ProfileDosen.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">SETRUM</div>
    <nav class="menu">
      <a href="home_dosen.html"><i class="fa fa-home"></i><span> Beranda</span></a> 
      <a href="kelasdosen.html"><i class="fa fa-book"></i><span> Kelas</span></a>
      <a href="ProfileDosen.html" class="active"><i class="fa fa-user"></i><span> Profil</span></a>
      <a href="#" id="logoutBtn"><i class="fa fa-sign-out-alt"></i><span> Keluar</span></a>
    </nav>
  </aside>

  <!-- Konten Utama -->
  <main class="content">
    <div class="profile-container">
      <img id="profileImage" alt="Profile" />
      <h3 id="profileName"></h3>

      <label for="nama">Nama</label>
      <input type="text" id="nama" readonly />

      <label for="nip">NIP</label>
      <input type="text" id="nip" readonly />
      <div id="nipError" class="error"></div>

      <button id="editBtn">Edit Profil</button>
    </div>
  </main>

  <!-- Popup Logout -->
  <div class="logout-popup" id="logoutPopup">
    <h3>Logout</h3>
    <p>Apakah Anda yakin ingin keluar?</p>
    <button class="yes" id="yesLogout">Ya</button>
    <button class="cancel" id="cancelLogout">Batal</button>
  </div>

  <script>
    // === CEK LOGIN ===
    const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!loggedInUser || (!loggedInUser.name && !loggedInUser.username)) {
      window.location.href = "/Mahasiswa/HTML/form_login.html";
    }

    // === KEY PENYIMPANAN ===
    const username = loggedInUser.username || loggedInUser.name || "guest";
    const profileKey = `profileDosen_${username}`;
    const imageKey = `profileImageDosen_${username}`;

    // === AMBIL DATA ===
    const profileData = JSON.parse(localStorage.getItem(profileKey)) || {};
    const savedImage = localStorage.getItem(imageKey);

    // === REFERENSI ELEMEN ===
    const imageEl = document.getElementById("profileImage");
    const nameEl = document.getElementById("profileName");
    const nameInput = document.getElementById("nama");
    const nipInput = document.getElementById("nip");
    const nipError = document.getElementById("nipError");

    // === TAMPILKAN DATA ===
    nameEl.textContent = profileData.nama || loggedInUser.name || "Dosen";
    nameInput.value = profileData.nama || loggedInUser.name || "";
    nipInput.value = profileData.nip || "";

    // === FOTO PROFIL ===
    if (savedImage && savedImage.trim() !== "") {
      imageEl.src = savedImage;
      imageEl.classList.remove("empty");
    } else {
      imageEl.removeAttribute("src");
      imageEl.classList.add("empty");
    }

    // === VALIDASI NIP ===
    if (nipInput.value) {
      nipError.style.display = "none";
    } else {
      nipError.style.display = "block";
      nipError.textContent = "NIP belum diisi!";
    }

    // === EDIT PROFIL ===
    document.getElementById("editBtn").addEventListener("click", () => {
      window.location.href = "editprofiledosen.html";
    });

    // === LOGOUT ===
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutPopup = document.getElementById('logoutPopup');
    const yesLogout = document.getElementById('yesLogout');
    const cancelLogout = document.getElementById('cancelLogout');

    if (logoutBtn && logoutPopup && yesLogout && cancelLogout) {
      logoutBtn.addEventListener("click", (e) => {
        e.preventDefault();
        logoutPopup.style.display = "block";
      });
      cancelLogout.addEventListener("click", () => {
        logoutPopup.style.display = "none";
      });
      yesLogout.addEventListener("click", () => {
        localStorage.removeItem("loggedInUser");
        window.location.href = '../../Mahasiswa/HTML/form_login.html';
      });
    }
  </script>

</body>
</html>
