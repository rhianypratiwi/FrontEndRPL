<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil â€” SETRUM</title>
  <link rel="stylesheet" href="../CSS/ProfileDosen.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  
</head>
<body>

  <aside class="sidebar">
    <div class="brand">SETRUM</div>
    <nav class="menu">
      <a href="home_dosen.html"><i class="fa fa-home"></i><span> Beranda</span></a> 
      <a href="kelasdosen.html"><i class="fa fa-book"></i><span> Kelas</span></a>
      <a href="ProfileDosen.html" class="active"><i class="fa fa-user"></i><span> Profil</span></a>
      <a href="#" id="logoutBtn"><i class="fa fa-sign-out-alt"></i><span> Keluar</span></a>
    </nav>
  </aside>

  <main class="content">
    <div class="profile-container">
      <img id="profileImage" src="https://i.pravatar.cc/100" alt="Profile" />

      <label for="nama">Nama</label>
      <input type="text" id="nama" readonly />

      <label for="nip">NIP</label>
      <input type="text" id="nip" readonly />
      <div id="nipError" class="error"></div>

      <button id="editBtn">Edit</button>
    </div>
  </main>

 <!-- Popup logout -->
  <div class="logout-popup" id="logoutPopup">
    <h3>Logout</h3>
    <p>Apakah Anda yakin ingin keluar?</p>
    <button class="yes" id="yesLogout">Ya</button>
    <button class="cancel" id="cancelLogout">Batal</button>
  </div>

  <script>
// --- CEK LOGIN (Kode Anda sudah benar) ---
const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!loggedInUser || (!loggedInUser.name && !loggedInUser.username)) {
  window.location.href = "form_login.html";
}

// === KUNCI PENYIMPANAN (Kode Anda sudah benar) ===
const username = loggedInUser.username || loggedInUser.name || "guest";
const profileKey = `profileDosen_${username}`;
const imageKey = `profileImageDosen_${username}`;

// === AMBIL DATA (Kode Anda sudah benar) ===
const profileData = JSON.parse(localStorage.getItem(profileKey)) || {};
const savedImage = localStorage.getItem(imageKey);

// === REFERENSI ELEMEN (Kode Anda sudah benar) ===
const imageEl = document.getElementById("profileImage");
const nameInput = document.getElementById("nama");
const nipInput = document.getElementById("nip");
const nipError = document.getElementById("nipError");

// === LOGIKA TAMPILKAN DATA (Kode Anda sudah benar) ===
// 1. Load data nama dan NIP
// (Jika data di profileKey ada, gunakan. Jika tidak, coba dari loggedInUser. Jika tidak, kosongkan)
nameInput.value = profileData.nama || loggedInUser.name || "";
nipInput.value = profileData.nip || ""; // NIP hanya dari profileData

// 2. Load foto profil
imageEl.src = savedImage || "https://i.pravatar.cc/100";

// 3. Validasi NIP (Peringatan "NIP belum diisi!")
if (nipInput.value) {
  nipError.style.display = "none";
} else {
  nipError.style.display = "block";
  nipError.textContent = "NIP belum diisi!";
}

// 4. Tombol Edit (Kode Anda sudah benar)
document.getElementById("editBtn").addEventListener("click", () => {
  window.location.href = "editprofiledosen.html";
});

// 5. Logout (Kode Anda sudah benar)

// === LOGOUT SCRIPT ===
  const logoutBtn = document.getElementById('logoutBtn');
  const logoutPopup = document.getElementById('logoutPopup');
  const yesLogout = document.getElementById('yesLogout');
  const cancelLogout = document.getElementById('cancelLogout');

  // Pastikan semua elemen ada sebelum menambahkan listener
  if (logoutBtn && logoutPopup && yesLogout && cancelLogout) {
    logoutBtn.addEventListener("click", (e) => {
      e.preventDefault(); // Mencegah link '#' pindah halaman
      logoutPopup.style.display = "block";
    });
    cancelLogout.addEventListener("click", () => {
      logoutPopup.style.display = "none";
    });
    yesLogout.addEventListener("click", () => {
      localStorage.removeItem("loggedInUser");
      window.location.href = "../../form_login.html"; // Arahkan ke login
    });
  }
  // === AKHIR LOGOUT SCRIPT ===
</script>

</body>
</html>