<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil â€” SETRUM</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../CSS/Profile.css" />
</head>
<body>

  <!-- === SIDEBAR === -->
  <aside class="sidebar">
    <div class="brand">SETRUM</div>
    <nav class="menu">
      <a href="home.html"><i class="fa fa-home"></i><span> Beranda</span></a>
      <a href="MataKuliah.html"><i class="fa fa-book"></i><span> Kelas</span></a>
      <a href="#" class="active"><i class="fa fa-user"></i><span> Profil</span></a>
      <a href="#" id="logoutBtn"><i class="fa fa-sign-out-alt"></i><span> Keluar</span></a>
    </nav>
  </aside>

  <!-- === KONTEN PROFIL === -->
  <main class="content">
    <div class="profile-container">
      <img id="profileImage" alt="">
      <h3 id="profileName">Nama Pengguna</h3>
      <p id="profileRole">Mahasiswa | Teknik Informatika</p>

      <div style="margin-top: 20px;">
        <label for="nim">NIM</label>
        <input type="text" id="nim" readonly />
        <div id="nimError" class="error"></div>

        <label for="kelas">Kelas</label>
        <input type="text" id="kelas" readonly />
        <div id="kelasError" class="error"></div>

        <button id="editBtn">Edit Profil</button>
      </div>
    </div>
  </main>

  <!-- === POPUP LOGOUT === -->
  <div class="logout-popup" id="logoutPopup">
    <h3>Logout</h3>
    <p>Apakah kamu yakin ingin keluar?</p>
    <button class="yes" id="yesLogout">Ya</button>
    <button class="cancel" id="cancelLogout">Batal</button>
  </div>

  <script>
    const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!loggedInUser || (!loggedInUser.name && !loggedInUser.username)) {
      window.location.replace("form_login.html");
    }

    const username = loggedInUser.username || loggedInUser.name || "guest";
    const profileKey = `profileData_${username}`;
    const imageKey = `profileImage_${username}`;

    const profileData = JSON.parse(localStorage.getItem(profileKey));
    const savedImage = localStorage.getItem(imageKey);

    const nameEl = document.getElementById("profileName");
    const imageEl = document.getElementById("profileImage");
    const roleEl = document.getElementById("profileRole");
    const nimInput = document.getElementById("nim");
    const kelasInput = document.getElementById("kelas");
    const nimError = document.getElementById("nimError");
    const kelasError = document.getElementById("kelasError");

    if (profileData) {
      nameEl.textContent = profileData.nama || loggedInUser.name || "Pengguna";
      nimInput.value = profileData.nim || "";
      kelasInput.value = profileData.kelas || "";
      roleEl.textContent = profileData.prodi ? `Mahasiswa | ${profileData.prodi}` : "Mahasiswa | Teknik Informatika";
    } else {
      nameEl.textContent = loggedInUser.name || "Pengguna";
    }

    if (savedImage) {
      imageEl.src = savedImage;
      imageEl.classList.remove("empty");
    } else {
      imageEl.removeAttribute("src");
      imageEl.classList.add("empty");
    }

    nimError.textContent = nimInput.value ? "" : "NIM belum diisi!";
    kelasError.textContent = kelasInput.value ? "" : "Kelas belum diisi!";

    document.getElementById("editBtn").addEventListener("click", () => {
      window.location.href = "edit_Profile.html";
    });

    const logoutBtn = document.getElementById("logoutBtn");
    const logoutPopup = document.getElementById("logoutPopup");
    const yesLogout = document.getElementById("yesLogout");
    const cancelLogout = document.getElementById("cancelLogout");

    logoutBtn.onclick = () => logoutPopup.style.display = "block";
    cancelLogout.onclick = () => logoutPopup.style.display = "none";
    yesLogout.onclick = () => {
      localStorage.removeItem("loggedInUser");
      window.location.replace("form_login.html");
    };
  </script>
</body>
</html>
